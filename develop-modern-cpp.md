---
title: '夜天之书 #38 短评《现代 C++ 白皮书》'
---

近几天读完了 Bjarne Stroustrup 的 HOPL4 论文 [Thriving in a Crowded and Changing World: C++ 2006–2020](https://www.stroustrup.com/hopl20main-p5-p-bfc9cd4--final.pdf) 经由 Boolan 组织翻译的中文版，相关文本内容托管在 GitHub 上，[在线阅读](https://github.com/cpp-club/cxx_hopl4_zh)。

不谈其中具体的技术细节，我从 Bjarne 反思 C++ 作为一门编程语言在几十年来如何发展，遇到的问题以及未来的方向的考虑的过程中得到了不少启发，这里做个转述和简短的评论。

## 目标与原则

一门编程语言也好，一个开源项目也好，要想获得长久的生命力，无一不是面向真实的用户问题，形成自己的一套解决方法和原则，并长期坚持予以贯彻。C++ 的发展在 Bjarne 的眼中即是如此。

C++ 作为一门通用编程语言，能够纳入其所要解决的问题涵盖的范围相当广泛。甚至可以说任何需求都可以是 C++ 的需求。在这样的背景下，Bjarne 还是给出了应该避免的错误关注点，指出哪些类型的需求是可疑的。对于一个雄心勃勃的新项目来说，将所有需求都纳入自己的范畴之内无疑是极具诱惑的，但是知道自己不做什么，才是让这个项目脚踏实地真正解决问题的第一步。

Bjarne 总结了 C++ 发展过程当中的教训，包括了一些错误的关注点

* 只为专家服务。某个功能从开始的时候就要满足所有专家的需要。
* 模仿。我们需要这个功能，因为它在另外某个语言里很流行。
* 理论性。语言理论里说语言一定要有这个特性。
* 革命性。此功能非常重要，以至于我们必须打破兼容性，或者摒弃那些不好的老方法。

这些都是非常经典的说辞，论文里却对它们全部予以驳斥。Bjarne 观察到用户对 C++ 的要求是

* 让语言更简单！
* 立即添加这两个必要特性！！
* 不要搞砸我的（任何）代码！！！

这三者其实是相互矛盾的，语言的简化和演进会对兼容性形成挑战，新增特性和简单性之间也会有所冲突。Bjarne 由此归纳出来的发展原则是

* 问题驱动。C++ 开发应该被那些真实世界中的具体问题的需求所驱动。
* 简单。C++ 应该从简单、高效、易用的解决方案中进行推广而成长。
* 高效。C++ 语言和标准库应该遵循零开销原则。
* 稳定性。不要搞砸我的代码！

并且几乎总是站在简单性的一边。好的软件通过提供恰如其分的抽象和合理的默认行为来简化用户逻辑的表达。Bjarne 反复提及的设计理念是所谓的“洋葱原则”

> 如果要完成的任务是简单的，那就用简单的方法做；当要完成的任务不是那么简单时，就需要更详细、更复杂的技巧或写法。这就好比你剥下了一层洋葱。剥得越深，流泪就越多。

这个原则也在 Perl 语言的设计思想当中有所体现

> Easy things should be easy, and hard things should be possible.

往上或许可以追溯到 Alan Kay 的类似观点

> Simple things should be simple, complex things should be possible.

简单，提供足够的封装，一个软件才能够为用户带来价值。

除此以外，对于 C++ 语言在实现上的原则，Bjarne 贯穿全文的强调了两点

* 语言结构到硬件设备的直接映射
* 零开销抽象
    * 你不用的东西，就不需要付出代价。
    * 你使用的东西，手工写的代码也不会更好。

这也是 C++ 定位在系统编程语言带来的需求，原文的表达是“不要给 C++ 以下的低级语言留有余地（汇编语言除外）”。

## 工作组织方式

原文第三章《C++ 标准委员会》花了一章的篇幅讲述了几十年间推动 C++ 语言演进的组织的架构，以及它是如何发挥作用的。限于短评的篇幅这里不做展开讨论，仅罗列原文总结的 C++ 标准委员会在设计和演进语言时面临的问题，几乎每一个都一针见血。强烈建议阅读原文全文（3.3 节），Bjarne 在各个特性的讨论中间也会以该特性为例子讲述碰到的问题和解决方案。

* 延迟
* 孤立特性
* 后来者居上
* 热情总青睐新事物
* 过度自信
* 实现时机不当
* 特性交互
* 篇幅和分心
* 精确规范
* 经院主义
* 方向
* 专一关注
* 原则的不适当应用
* 倾向专家的偏见
* 聪明的问题
* 不愿妥协
* 缺乏优先级
* 完美主义
* 少数人的阻挠
* 内聚的团体
