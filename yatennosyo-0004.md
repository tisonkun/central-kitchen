---
title: '夜天之书 #4'
---

今天当一回全球开源技术峰会“开源成功，企业开源办公室（OSPO）先行”圆桌的场外观众。[圆桌录像链接](https://play.itdks.com/watch/10468548)，约两小时前后开始，请自行取用。

整个圆桌过程分为针对四个嘉宾的主题提问，和现场自由问答环节。我从中挑选几个感兴趣的问题做展开，先对所有问题做一个罗列。

主题提问如下。

* 企业开源的目标如何与公司发展的方向相结合？
* 企业为什么要贡献开源？
* 字节跳动如何看待企业开源办公室？
* 本土企业开源办公室和国际领先的案例有哪些差距？

自由问答如下。

* 当下开源软件的成熟度是怎么样的？
* 如何看待开源软件的作者修改许可证的行为？
* 企业如何平衡开源和日常开发工作的关系？
* 如何看待员工投入开源社区以后被挖走，要不要投人去贡献？
* 核心产品就是开源产品，要不要设置企业开源办公室？
* 企业员工个人开发开源软件，法律上有无著作权及使用上的风险？

**第一个我想讲的问题，企业为什么要贡献开源。**

其实这个问题的角度比较多，圆桌上对这个大议题的讨论也比较零散。总的来说，跟上面列举出来的企业开源的目标如何与公司发展的方向相结合，以及企业如何平衡开源和日常开发工作的关系都有关系。

Keith 为这个问题提供了一个比较好的分析层次，我会顺着这个层次来展开，即企业为什么要贡献开源，需要结合企业参与开源项目的阶段来分析。第一个阶段是用户阶段，第二个阶段是解决方案供应商阶段，第三个阶段是开源项目的开发商阶段。

用户阶段也就是使用开源项目的阶段。这个时候企业能够贡献开源的行为常见的有三种，一是提供用户案例为开源软件站台，二是资助开源软件或是与研发开源软件的公司签订服务或订阅合同支持开源软件发展，三是投入人力参与开源社区的发展。

第一和第二点都是从纯粹用户视角来设法与开源社区取得直接的接触，在社区亮相并形成品牌，以吸引到开源人才或是社区生态的开发者的关注，从而在公司声誉和人才招聘上取得优势。

第三点在用户身份的基础上，进一步发挥主动性，投入人力参与开源社区的发展。这与其他两个阶段投入人力参与的不同点在于，企业并不期望对外提供解决方案，或是深入参与开源项目的发展，其根本的出发点还是培养开源软件的研发运维人才，解决企业自身的应用开发问题和问题排查的需求。

这一阶段的例子，例如诸多参与大数据项目或云原生项目的互联网公司程序员，他们背后的公司或团队并没有想着实现一个解决方案来销售，他们也还不足以形成主导开源项目的发展的力量，但是他们通过在开源社区的参与，解决了生产环境上遇到的问题，深入理解了开源软件的原理，指导公司正确使用开源软件。同时，在社区的出现使得潜在的人才群体得知这家公司需要相应的工程师，甚至认同这家公司的工程师在社区当中表现出来的素质，产生想与其一起工作的冲动，从而取得人才招聘上取得优势

解决方案供应商阶段的企业贡献开源也有三种形式。一是拓展开源软件的生态，持续集成形成解决具体企业需求的技术方案。二是反哺上游社区，将成型解决方案里通用的功能贡献回上游社区，将场景化的、专有的功能，转换为机制与策略的结合，并将机制贡献回上游社区。三是宣传包含开源软件的解决方案满足客户需求的案例。

第三点除了和用户阶段的公司一样为了在人才招聘上取得优势以外，作为解决方案供应商，展示用户案例对自己的品牌打造也有大有裨益的。

第一第二点同属于发展开源软件解决方案生态的范畴。

一方面，持续集成是组合软件形成更有价值的解决方案的不二法门，能够持续集成不同系统，满足各种场景需求的软件，才是好软件。展示这种能力，既提升了自己的技术影响力，行业话语权，也是为开源软件的普适性和中立性站台。这种持续集成的能力至关重要，例如数据管理软件都有一个“One Platform, All Data”的梦想，如果在某个场景下的集成出现障碍，那么这个梦想也就宣告破灭。

另一方面，反哺开源社区的价值非常明显，却常常被下游厂商所忽略，直到遇到麻烦，才追悔莫及。

虽然开源社区当中针对同一个议题有不同声音时，其机制总是提供 fork 出去单干的选项，但是实际动用这个选项的极少。哪怕是在 Java 社区当中针对模块管理方案，Oracle 新兴的 Jigsaw 方案和 IBM 和当年的 Sun 公司等多家企业联手打造的成熟的 OSGi 方案的激烈对垒，在一番拉锯过后，还是妥协了 Jigsaw 方案，没有两派人马分道扬镳。我在某个场合下曾经劝说试图 fork Golang 以实现 profiling 插桩功能的同学关于这个行为的风险，

> 我们根本 hold 不住一整个编程语言生态，也控不住开发人员对“自己的编程语言”或者“最好的编程语言”的狂热。在缺乏上游强有力的支持下，所有想着和上游 keep sync 的最后都裂开了。

圆桌嘉宾王泽锋提到，如果你的改动是通用的功能，你不做，别人也会做，那就应该贡献回上游。否则别人的方案上线后，你要追赶最新版本就不得不做适配，你的工作可能白费，或者需要辛苦地调和两种方案诸多细微的差异。如果你的改动是场景化的、专有的功能，那么应该利用插件化的方式，将功能转换为机制与策略的结合，并将机制贡献回上游社区。否则同样你会在追版本的时候付出巨大的代价。

没错，“缺乏上游强有力的支持下，所有想着和上游 keep sync 的最后都裂开了”这句话就是这个观点的浓缩版。开源软件走一个方向，你的修订版本走另一个方向，后续发展的代码能相互利用的可能性极低，因为已经基于不同的假设做了太多的改动。参与开源，赢得话语权，参与软件发展决策，实际上就是保护自己建立在开源软件上的解决方案的最佳手段。

只要你有过 rebase 上游的可怕经历，你就会明白我在说什么。BLINK 在 2019 年初亮相之前，将自己内部魔改 Flink 的修改都 rebase 到了 Flink 1.5.1 版本上。这个过程及其折磨，历时半年，并反复修复以前修复过的问题，因为 cherry-pick 虽然基于特性，但是实际操作是基于 PR 一个一个弄的，前一个 PR 可能有问题，被隔了老远的 PR 修复了，这种事情谁会知道。结果等到整个工作弄完了，Flink 也已经发布了 1.7.0 版本了，你的用户会来问你，那些上游很 fancy 的功能，你怎么没有啊？如果没有后来的收购，再这么 rebase 下去，还有没有时间开发新功能就不好说了。

其实，这也是我推崇开源协同，喜欢开源软件的原因之一。如果你是 AWS 那样的巨头云厂商，有强悍的研发力量和资金，也不是不能在出现分歧的时候断然 fork 源代码继续开发。这里面的道理是，上游社区掌握着软件设计的初衷和开发软件所需的技术知识，这是赤裸裸的技术军备竞赛，上游大多数情况下有着绝对的技术领先，从而使得整个生态围绕着这个先进生产力不断发展。

开源项目的开发商阶段，贡献开源就是开发自己的产品，所以为什么要贡献开源是不言自明的。关于这种情形，会出现新的关注点。我们放到“核心产品就是开源产品”的话题讨论。

上面所说的三个阶段是根据企业与开源社区结合的紧密程度递进的，但是不是说企业必须按照这个阶段一步一步参与。

从消费者角色到生产者角色自然是一个递进的过程，但是也有解决方案供应商一上来就从第二阶段开始，或者企业就是将核心产品作为开源项目开放，直接从第三阶段开始。这都是有可能的。

最后，解决了企业为什么要贡献开源的问题，也就解决了企业如何平衡开源和日常开发工作的关系的问题。因为不需要专门的去平衡，开源工作就是日常工作的一部分。这也是这场圆桌当中反复强调的要点，即企业开源办公室要关注并关联起公司愿景与社区使命，使企业能够在参与社区的过程中，从社区创造的价值当中受益。

**第二个我想讲的问题，要不要鼓励或者要求员工去开源社区贡献。**

**第三个我想讲的问题，核心产品就是开源产品，应该怎么认识企业与社区的关系。**

这两个问题展开也有不少内容，今天的日签从晚上九点钟才开始写，再写下去恐怕赶不及今天发布了，且待明天再做讨论。
